<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ç‡ŸéšŠæ´—æ¾¡æ’éšŠ</title>
<style>
body { font-family: sans-serif; padding: 20px; }
.card { border:1px solid #ccc; padding:15px; margin:10px 0; border-radius:10px; }
.big { font-size:22px; font-weight:bold; }
button { padding:10px 15px; border:none; border-radius:8px; background:black; color:white; }
input { padding:10px; border-radius:8px; border:1px solid #ccc; }
</style>
</head>
<body>

<div class="card">
  <div class="big">ğŸš¿ æ´—æ¾¡æ’éšŠç³»çµ±</div>
</div>

<div class="card">
  <div class="big">ç¾åœ¨æ´—æ¾¡ï¼š <span id="current">â€”</span></div>
  <div class="big">ä¸‹ä¸€ä½æº–å‚™ï¼š <span id="next">â€”</span></div>
</div>

<div class="card">
  <input id="nameInput" placeholder="è¼¸å…¥åå­—">
  <button onclick="joinQueue()">åŠ å…¥æ’éšŠ</button>
</div>

<div class="card">
  <button onclick="finish()">æˆ‘æ´—å¥½äº† â†’ å«ä¸‹ä¸€ä½</button>
</div>

<div class="card">
  <div class="big">æ’éšŠåå–®</div>
  <ol id="queueList"></ol>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "ä½ çš„apiKey",
  authDomain: "ä½ çš„authDomain",
  databaseURL: "ä½ çš„databaseURL",
  projectId: "ä½ çš„projectId",
  storageBucket: "ä½ çš„storageBucket",
  messagingSenderId: "ä½ çš„messagingSenderId",
  appId: "ä½ çš„appId"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const queueRef = ref(db, "bathQueue");

onValue(queueRef, (snap) => {
  const queue = snap.val() || [];
  document.getElementById("current").innerText = queue[0] || "â€”";
  document.getElementById("next").innerText = queue[1] || "â€”";
  let list = document.getElementById("queueList");
  list.innerHTML = "";
  queue.forEach(name=>{
    let li = document.createElement("li");
    li.innerText = name;
    list.appendChild(li);
  });
});

window.joinQueue = async function(){
  let name = document.getElementById("nameInput").value.trim();
  if(!name) return;
  await runTransaction(queueRef, (queue)=>{
    queue = queue || [];
    if(queue.includes(name)) return queue;
    queue.push(name);
    return queue;
  });
  document.getElementById("nameInput").value="";
};

window.finish = async function(){
  if(confirm("ç¢ºå®šæ´—å¥½äº†å—ï¼Ÿ")){
    await runTransaction(queueRef, (queue)=>{
      queue = queue || [];
      queue.shift();
      return queue;
    });
  }
};
</script>

</body>
</html>
