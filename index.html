<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç‡ŸéšŠæ´—æ¾¡æ’éšŠ</title>

<style>
body { font-family: sans-serif; padding:20px; background:#f5f5f5; }
.card { background:white; padding:20px; margin:15px 0; border-radius:12px; border:1px solid #ddd; }
h1 { margin:0; }
button { padding:12px 16px; border-radius:10px; border:none; cursor:pointer; }
.black { background:black; color:white; }
input { padding:12px; border-radius:10px; border:1px solid #ccc; }
</style>
</head>

<body>

<div class="card">
<h1>ğŸš¿ æ´—æ¾¡æ’éšŠç³»çµ±</h1>
</div>

<div class="card">
<h2>ç¾åœ¨æ´—æ¾¡ï¼š<span id="current">â€”</span></h2>
<h2>ä¸‹ä¸€ä½æº–å‚™ï¼š<span id="next">â€”</span></h2>
</div>

<div class="card">
<input id="name" placeholder="è¼¸å…¥åå­—">
<button class="black" onclick="join()">åŠ å…¥æ’éšŠ</button>
</div>

<div class="card">
<button onclick="done()">æˆ‘æ´—å¥½äº† â†’ å«ä¸‹ä¸€ä½</button>
</div>

<div class="card">
<h2>æ’éšŠåå–®</h2>
<ul id="list"></ul>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "æ›æˆä½ çš„",
  authDomain: "æ›æˆä½ çš„",
  databaseURL: "æ›æˆä½ çš„",
  projectId: "æ›æˆä½ çš„",
  storageBucket: "æ›æˆä½ çš„",
  messagingSenderId: "æ›æˆä½ çš„",
  appId: "æ›æˆä½ çš„"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const queueRef = db.ref("queue");
const stateRef = db.ref("state");

queueRef.on("value", snap => {
  const list = document.getElementById("list");
  list.innerHTML = "";
  const data = snap.val() || {};
  Object.keys(data).forEach(key=>{
    const li = document.createElement("li");
    li.textContent = data[key];
    list.appendChild(li);
  });
});

stateRef.on("value", snap=>{
  const s = snap.val() || {};
  document.getElementById("current").textContent = s.current || "â€”";
  document.getElementById("next").textContent = s.next || "â€”";
});

function join(){
  const name = document.getElementById("name").value.trim();
  if(!name) return alert("è«‹è¼¸å…¥åå­—");
  queueRef.push(name);
  document.getElementById("name").value="";
}

async function done(){
  const snap = await queueRef.limitToFirst(2).once("value");
  const data = snap.val();
  if(!data){
    stateRef.set({current:"", next:""});
    return;
  }

  const keys = Object.keys(data);
  const current = data[keys[0]];
  const next = data[keys[1]] || "";

  stateRef.set({current, next});
  await queueRef.child(keys[0]).remove();
}
</script>

</body>
</html>
